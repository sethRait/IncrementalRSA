<!--
This code is for the purpose of demonstrating basic sql-injection attacks and is
not web-safe.
-->
<html>
<body>
<?php
$username = "root";
$password = "root";
$hostname = "localhost";
$result;

// Disable Google-Chome Reflective XSS Protection
header("X-XSS-Protection: 0");

// Connect to the database
$dbhandle = mysqli_connect($hostname, $username, $password)
	or die("Unable to connect to MySQL");

// Select a database
$selected = mysqli_select_db($dbhandle, "test")
	or die("Unable to select test");

// Query user
$uname = $_POST["un"];
$pass = $_POST["pw"];

// Login or sign up
switch($_POST['action']) {
	case 'login':
		if (validate()) {
			echo "Welcome, ".$uname."!<br>";
		}
		else {
			echo "User ".$uname." does not exist<br>";
		}

		while ($row = mysqli_fetch_array($result)) {
			echo "<br>Username: ".$row{'Username'}.
				 "<br> Password: ".$row{'Password'}."<br>";
		}
		break;

	case 'signup':
		if (!validate()) {
			$query = "INSERT INTO Users ".
				 	"(Username, Password) ".
				 	"VALUES ".
				 	"('$uname', '$pass')";
			$result = mysqli_query($dbhandle, $query);
			if (!$result) {
				die('Could not insert data '.mysqli_error($dbhandle));
			}
		}
		header('location: index.html');
}

// Validate user input.  True if user exists, false otherwise.
function validate() {
	global $uname, $pass, $dbhandle, $result;
	$query = "SELECT * FROM Users ".
			 "WHERE Users.Username='$uname' ".
			 "AND Users.Password='$pass'";
	$result = mysqli_query($dbhandle, $query);
	echo "<h2>'$query'</h2>";
	//echo "<h1>'$result' </h1>";
	if (mysqli_num_rows($result) >= 1) {
		return true;
	}
	if (!$result) {
		return false;
	}
}

// Close the connection
mysqli_close($dbhandle);
?>
</body>
</html>
